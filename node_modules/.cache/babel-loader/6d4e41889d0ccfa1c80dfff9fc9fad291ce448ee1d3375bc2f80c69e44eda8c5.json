{"ast":null,"code":"import React,{forwardRef,useCallback,useEffect,useRef,useImperativeHandle}from'react';import'./ShowClothes.css';import clothImageSrc from'./Remove-bg.ai_1713274468747(1).png';import{jsx as _jsx}from\"react/jsx-runtime\";const ClothBox=/*#__PURE__*/forwardRef((_ref,ref)=>{let{imgscale,sketchDataURL,patternDataURL,selected,spacing,selectedcolor}=_ref;const canvasRef=useRef(null);// const saveCanvasAsImage = useCallback(() => {\n//     const canvas = canvasRef.current;\n//     if (canvas) {\n//         const imageData = canvas.toDataURL('image/png', 1.0); // Ensure you use the canvas data.\n//         const link = document.createElement('a');\n//         link.href = imageData;\n//         link.download = '裙子.png';\n//         document.body.appendChild(link);\n//         link.click();\n//         document.body.removeChild(link);\n//     }\n// }, []);\n//\n// useImperativeHandle(ref, () => ({\n//     saveCanvasAsImage,\n// }));\nuseEffect(()=>{const clothCanvas=canvasRef.current;if(!clothCanvas)return;const clothCtx=clothCanvas.getContext('2d');const patternImage=new Image();const clothImage=new Image();const maskImage=new Image();// ����ɰ�ͼ��\nconst maskDataURL=\"/image/Remove.png\";const neckWidth=clothCanvas.width*0.3;// ��ڿ��Ϊ������ȵ�30%\nconst neckHeight=clothCanvas.height*0.1;// ��ڸ߶�Ϊ�����߶ȵ�10%\nconst neckX=(clothCanvas.width-neckWidth)/2;// ���ˮƽ����\nconst neckY=0;// ����ڻ�������\nclothImage.onload=()=>{clothCanvas.width=clothImage.width;clothCanvas.height=clothImage.height;clothCtx.clearRect(0,0,clothCanvas.width,clothCanvas.height);clothCtx.drawImage(clothImage,0,0);clothCtx.fillStyle=selectedcolor?selectedcolor:'transparent';// ��� selected Ϊ true��ʹ�� selectedColor������͸��\nclothCtx.fillRect(neckX,neckY,neckWidth,neckHeight);patternImage.onload=()=>{const tempCanvas=document.createElement('canvas');const tempCtx=tempCanvas.getContext('2d');tempCanvas.width=clothCanvas.width;tempCanvas.height=clothCanvas.height;// ����ͼ���Ŵ��ĳߴ�\nconst scaleX=tempCanvas.width/patternImage.width;const scaleY=tempCanvas.height/patternImage.height;const scale=Math.max(scaleX,scaleY);// ѡ��ϴ�����ű�����������������\nconst patternWidth=patternImage.width*scale;const patternHeight=patternImage.height*scale;const offsetX=(tempCanvas.width-patternWidth)/2;// ˮƽ����\nconst offsetY=(tempCanvas.height-patternHeight)/2;// ��ֱ����\n// ����ʱ�����ϻ���ͼ��\ntempCtx.drawImage(patternImage,offsetX,offsetY,patternWidth,patternHeight);// ������������ͼ������������ɰ�\nconst patternMaskCanvas=document.createElement('canvas');const patternMaskCtx=patternMaskCanvas.getContext('2d');patternMaskCanvas.width=maskImage.width;patternMaskCanvas.height=maskImage.height;patternMaskCtx.drawImage(maskImage,0,0);// Ӧ���ɰ浽ͼ����\nconst patternMaskImageData=patternMaskCtx.getImageData(0,0,maskImage.width,maskImage.height);const tempImageData=tempCtx.getImageData(0,0,tempCanvas.width,tempCanvas.height);for(let i=0;i<patternMaskImageData.data.length;i+=4){if(patternMaskImageData.data[i+3]===0){tempImageData.data[i+3]=0;}}tempCtx.putImageData(tempImageData,0,0);// ��ͼ��Ӧ�õ��·���\nclothCtx.globalCompositeOperation='multiply';clothCtx.drawImage(tempCanvas,0,0);// ���úϳɲ���\nclothCtx.globalCompositeOperation='source-over';};patternImage.src=patternDataURL;};clothImage.src=clothImageSrc;maskImage.src=maskDataURL;// �����ɰ�ͼ��\n},[patternDataURL]);return/*#__PURE__*/_jsx(\"div\",{className:\"canvas-container\",children:/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,className:\"cloth-canvas2\"})});});export default ClothBox;","map":{"version":3,"names":["React","forwardRef","useCallback","useEffect","useRef","useImperativeHandle","clothImageSrc","jsx","_jsx","ClothBox","_ref","ref","imgscale","sketchDataURL","patternDataURL","selected","spacing","selectedcolor","canvasRef","clothCanvas","current","clothCtx","getContext","patternImage","Image","clothImage","maskImage","maskDataURL","neckWidth","width","neckHeight","height","neckX","neckY","onload","clearRect","drawImage","fillStyle","fillRect","tempCanvas","document","createElement","tempCtx","scaleX","scaleY","scale","Math","max","patternWidth","patternHeight","offsetX","offsetY","patternMaskCanvas","patternMaskCtx","patternMaskImageData","getImageData","tempImageData","i","data","length","putImageData","globalCompositeOperation","src","className","children"],"sources":["F:/同济实习/cutting英文版/cutting/src/containers/ShowClothes/ClothBox2.js"],"sourcesContent":["import React, { forwardRef, useCallback, useEffect, useRef, useImperativeHandle } from 'react';\r\nimport './ShowClothes.css';\r\nimport clothImageSrc from './Remove-bg.ai_1713274468747(1).png';\r\n\r\nconst ClothBox = forwardRef(({ imgscale, sketchDataURL, patternDataURL, selected, spacing,selectedcolor }, ref) => {\r\n    const canvasRef = useRef(null);\r\n\r\n    // const saveCanvasAsImage = useCallback(() => {\r\n    //     const canvas = canvasRef.current;\r\n    //     if (canvas) {\r\n    //         const imageData = canvas.toDataURL('image/png', 1.0); // Ensure you use the canvas data.\r\n    //         const link = document.createElement('a');\r\n    //         link.href = imageData;\r\n    //         link.download = '裙子.png';\r\n    //         document.body.appendChild(link);\r\n    //         link.click();\r\n    //         document.body.removeChild(link);\r\n    //     }\r\n    // }, []);\r\n    //\r\n    // useImperativeHandle(ref, () => ({\r\n    //     saveCanvasAsImage,\r\n    // }));\r\n\r\n    useEffect(() => {\r\n        const clothCanvas = canvasRef.current;\r\n        if (!clothCanvas) return;\r\n        const clothCtx = clothCanvas.getContext('2d');\r\n        const patternImage = new Image();\r\n        const clothImage = new Image();\r\n        const maskImage = new Image(); // ����ɰ�ͼ��\r\n        const maskDataURL = \"/image/Remove.png\";\r\n        const neckWidth = clothCanvas.width * 0.3; // ��ڿ��Ϊ������ȵ�30%\r\n        const neckHeight = clothCanvas.height * 0.1; // ��ڸ߶�Ϊ�����߶ȵ�10%\r\n        const neckX = (clothCanvas.width - neckWidth) / 2; // ���ˮƽ����\r\n        const neckY = 0; // ����ڻ�������\r\n\r\n        clothImage.onload = () => {\r\n            clothCanvas.width = clothImage.width;\r\n            clothCanvas.height = clothImage.height;\r\n            clothCtx.clearRect(0, 0, clothCanvas.width, clothCanvas.height);\r\n            clothCtx.drawImage(clothImage, 0, 0);\r\n            clothCtx.fillStyle = selectedcolor ? selectedcolor : 'transparent'; // ��� selected Ϊ true��ʹ�� selectedColor������͸��\r\n            clothCtx.fillRect(neckX, neckY, neckWidth, neckHeight);\r\n\r\n            patternImage.onload = () => {\r\n                const tempCanvas = document.createElement('canvas');\r\n                const tempCtx = tempCanvas.getContext('2d');\r\n                tempCanvas.width = clothCanvas.width;\r\n                tempCanvas.height = clothCanvas.height;\r\n\r\n                // ����ͼ���Ŵ��ĳߴ�\r\n                const scaleX = tempCanvas.width / patternImage.width;\r\n                const scaleY = tempCanvas.height / patternImage.height;\r\n                const scale = Math.max(scaleX, scaleY); // ѡ��ϴ�����ű�����������������\r\n\r\n                const patternWidth = patternImage.width * scale;\r\n                const patternHeight = patternImage.height * scale;\r\n                const offsetX = (tempCanvas.width - patternWidth) / 2;  // ˮƽ����\r\n                const offsetY = (tempCanvas.height - patternHeight) / 2;  // ��ֱ����\r\n\r\n                // ����ʱ�����ϻ���ͼ��\r\n                tempCtx.drawImage(patternImage, offsetX, offsetY, patternWidth, patternHeight);\r\n\r\n                // ������������ͼ������������ɰ�\r\n                const patternMaskCanvas = document.createElement('canvas');\r\n                const patternMaskCtx = patternMaskCanvas.getContext('2d');\r\n                patternMaskCanvas.width = maskImage.width;\r\n                patternMaskCanvas.height = maskImage.height;\r\n                patternMaskCtx.drawImage(maskImage, 0, 0);\r\n\r\n                // Ӧ���ɰ浽ͼ����\r\n                const patternMaskImageData = patternMaskCtx.getImageData(0, 0, maskImage.width, maskImage.height);\r\n                const tempImageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);\r\n                for (let i = 0; i < patternMaskImageData.data.length; i += 4) {\r\n                    if (patternMaskImageData.data[i + 3] === 0) {\r\n                        tempImageData.data[i + 3] = 0;\r\n                    }\r\n                }\r\n                tempCtx.putImageData(tempImageData, 0, 0);\r\n\r\n                // ��ͼ��Ӧ�õ��·���\r\n                clothCtx.globalCompositeOperation = 'multiply';\r\n                clothCtx.drawImage(tempCanvas, 0, 0);\r\n\r\n                // ���úϳɲ���\r\n                clothCtx.globalCompositeOperation = 'source-over';\r\n            };\r\n            patternImage.src = patternDataURL;\r\n        };\r\n\r\n        clothImage.src = clothImageSrc;\r\n        maskImage.src = maskDataURL; // �����ɰ�ͼ��\r\n    }, [patternDataURL]);\r\n\r\n\r\n    return (\r\n        <div className=\"canvas-container\" >\r\n            <canvas ref={canvasRef} className=\"cloth-canvas2\"></canvas>\r\n        </div>\r\n    );\r\n});\r\n\r\nexport default ClothBox;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}