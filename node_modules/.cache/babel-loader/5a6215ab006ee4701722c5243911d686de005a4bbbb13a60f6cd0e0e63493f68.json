{"ast":null,"code":"import React,{forwardRef,useCallback,useEffect,useImperativeHandle,useRef}from'react';import'./ShowClothes.css';import clothImageSrc from'./Remove-bg.ai_1713274468747(1).png';import{jsx as _jsx}from\"react/jsx-runtime\";const ClothBox=/*#__PURE__*/forwardRef((_ref,ref)=>{let{imgscale,sketchDataURL,patternDataURL,selected,spacing}=_ref;const canvasRef=useRef(null);const saveCanvasAsImage=useCallback(()=>{const canvas=canvasRef.current;if(canvas){const imageData=patternDataURL;const link=document.createElement('a');link.href=imageData;link.download='canvas-image.png';document.body.appendChild(link);link.click();document.body.removeChild(link);}},[patternDataURL]);// ????????\n// const debounce = useCallback((func, wait) => {\n//   let timeout;\n//   return (...args) => {\n//     clearTimeout(timeout);\n//     timeout = setTimeout(() => {\n//       func.apply(this, args);\n//     }, wait);\n//   };\n// }, []);\nuseImperativeHandle(ref,()=>({saveCanvasAsImage}));console.log(canvasRef.current);useEffect(()=>{const clothCanvas=canvasRef.current;const clothCtx=clothCanvas.getContext('2d');const patternImage=new Image();const clothImage=new Image();clothImage.onload=()=>{clothCanvas.width=clothImage.width;clothCanvas.height=clothImage.height;clothCtx.clearRect(0,0,clothCanvas.width,clothCanvas.height);clothCtx.drawImage(clothImage,0,0);patternImage.onload=()=>{const tempCanvas=document.createElement('canvas');const tempCtx=tempCanvas.getContext('2d');tempCanvas.width=clothCanvas.width;tempCanvas.height=clothCanvas.height;tempCtx.drawImage(patternImage,0,0,tempCanvas.width,tempCanvas.height);tempCtx.globalCompositeOperation='destination-in';tempCtx.drawImage(clothImage,0,0,tempCanvas.width,tempCanvas.height);clothCtx.globalCompositeOperation='multiply';clothCtx.drawImage(tempCanvas,0,0);// ???��????????\nclothCtx.globalCompositeOperation='source-over';};patternImage.src=patternDataURL;};clothImage.src=clothImageSrc;console.log(clothImage.src);},[patternDataURL]);return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,className:\"cloth-canvas\",style:{marginTop:'50px'}})});});export default ClothBox;","map":{"version":3,"names":["React","forwardRef","useCallback","useEffect","useImperativeHandle","useRef","clothImageSrc","jsx","_jsx","ClothBox","_ref","ref","imgscale","sketchDataURL","patternDataURL","selected","spacing","canvasRef","saveCanvasAsImage","canvas","current","imageData","link","document","createElement","href","download","body","appendChild","click","removeChild","console","log","clothCanvas","clothCtx","getContext","patternImage","Image","clothImage","onload","width","height","clearRect","drawImage","tempCanvas","tempCtx","globalCompositeOperation","src","children","className","style","marginTop"],"sources":["F:/同济实习/cutting/src/containers/ShowClothes/ClothBox2.js"],"sourcesContent":["import React, {forwardRef, useCallback, useEffect, useImperativeHandle, useRef} from 'react';\r\nimport './ShowClothes.css';\r\nimport clothImageSrc from './Remove-bg.ai_1713274468747(1).png';\r\nconst ClothBox = forwardRef(({ imgscale,sketchDataURL, patternDataURL,selected,spacing }, ref) => {\r\n    const canvasRef = useRef(null);\r\n\r\n    const saveCanvasAsImage = useCallback(() => {\r\n        const canvas = canvasRef.current;\r\n        if (canvas) {\r\n            const imageData = patternDataURL;\r\n            const link = document.createElement('a');\r\n            link.href = imageData;\r\n            link.download = 'canvas-image.png';\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            document.body.removeChild(link);\r\n        }\r\n    }, [patternDataURL]);\r\n\r\n    // ????????\r\n    // const debounce = useCallback((func, wait) => {\r\n    //   let timeout;\r\n    //   return (...args) => {\r\n    //     clearTimeout(timeout);\r\n    //     timeout = setTimeout(() => {\r\n    //       func.apply(this, args);\r\n    //     }, wait);\r\n    //   };\r\n    // }, []);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        saveCanvasAsImage,\r\n    }));\r\n    console.log(canvasRef.current);\r\n    useEffect(() => {\r\n        const clothCanvas = canvasRef.current;\r\n        const clothCtx = clothCanvas.getContext('2d');\r\n        const patternImage = new Image();\r\n        const clothImage = new Image();\r\n\r\n        clothImage.onload = () => {\r\n            clothCanvas.width = clothImage.width;\r\n            clothCanvas.height = clothImage.height;\r\n            clothCtx.clearRect(0, 0, clothCanvas.width, clothCanvas.height);\r\n            clothCtx.drawImage(clothImage, 0, 0);\r\n\r\n            patternImage.onload = () => {\r\n                const tempCanvas = document.createElement('canvas');\r\n                const tempCtx = tempCanvas.getContext('2d');\r\n                tempCanvas.width = clothCanvas.width;\r\n                tempCanvas.height = clothCanvas.height;\r\n\r\n                tempCtx.drawImage(patternImage, 0, 0, tempCanvas.width, tempCanvas.height);\r\n\r\n                tempCtx.globalCompositeOperation = 'destination-in';\r\n                tempCtx.drawImage(clothImage, 0, 0, tempCanvas.width, tempCanvas.height);\r\n\r\n                clothCtx.globalCompositeOperation = 'multiply';\r\n                clothCtx.drawImage(tempCanvas, 0, 0);\r\n\r\n                // ???��????????\r\n                clothCtx.globalCompositeOperation = 'source-over';\r\n            };\r\n            patternImage.src = patternDataURL;\r\n\r\n\r\n        };\r\n        clothImage.src = clothImageSrc;\r\n        console.log(clothImage.src)\r\n    }, [patternDataURL]);\r\n\r\n\r\n\r\n\r\n\r\n    return (\r\n        <div>\r\n            <canvas ref={canvasRef} className=\"cloth-canvas\"style={{ marginTop: '50px' }}></canvas>\r\n            {/* ?��????? */}\r\n            {/*<canvas ref={patternCanvasRef} className=\"pattern-canvas\"></canvas> /!* ??????? *!/*/}\r\n        </div>\r\n    );\r\n\r\n});\r\n\r\nexport default ClothBox;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}