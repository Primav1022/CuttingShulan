{"ast":null,"code":"import React,{useEffect,useState}from'react';import StepBar from'../../components/StepBar/StepBar';import InputBox from'../../components/InputBox/InputBox';import MaterialLibrary from'../../components/MaterialLibrary/MaterialLibrary';import ShowImg from'../../components/ShowImg/ShowImg';import'./GenerationImg.css';import{useIndexedDBStorage}from'./storage';import LoadingAnimation from\"../../components/loadingicon/loadingicon\";// ȷ������·����ȷ\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const GenerationImg=_ref=>{let{currentStep,handleNextStep,handlePrevStep,selectedMaterials,onAddMaterial}=_ref;const[inputValue,setInputValue]=useState('');const[isUploading,setIsUploading]=useState(false);const[showImages,setShowImages]=useSessionStorageState('showImages',false);const[generatedImages,setGeneratedImages]=useIndexedDBStorage('generatedImages',[]);function useSessionStorageState(key,defaultValue){const[state,setState]=useState(()=>{const storedValue=sessionStorage.getItem(key);return storedValue!==null?JSON.parse(storedValue):defaultValue;});useEffect(()=>{sessionStorage.setItem(key,JSON.stringify(state));},[key,state]);return[state,setState];}const handleInputChange=e=>{setInputValue(e.target.value);};const handleUpload=async()=>{setIsUploading(true);console.log('Uploading:',inputValue);try{const response=await fetch('http://202.120.165.127:8023/generate-image',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:inputValue})});if(response.ok){const imagesBase64=await response.json();const imagesUrls=imagesBase64.map(imgBase64=>\"data:image/png;base64,\".concat(imgBase64));setGeneratedImages(prevImages=>[...prevImages,...imagesUrls]);setShowImages(true);}else{console.error('Failed to generate image');}}catch(error){console.error('Error:',error);}setInputValue('');setIsUploading(false);};const handleKeyPress=e=>{if(e.key==='Enter'){handleUpload();}};return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"left-side\",children:[/*#__PURE__*/_jsx(StepBar,{currentStep:currentStep,handleNextStep:handleNextStep,handlePrevStep:handlePrevStep}),/*#__PURE__*/_jsxs(\"div\",{className:\"middle\",children:[showImages&&/*#__PURE__*/_jsx(ShowImg,{onAddToLibrary:onAddMaterial,images:generatedImages}),isUploading&&/*#__PURE__*/_jsx(LoadingAnimation,{})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bottom\",children:/*#__PURE__*/_jsx(InputBox,{value:inputValue,onChange:handleInputChange,onUpload:handleUpload,onKeyPress:handleKeyPress,isUploading:isUploading})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"right-side\",children:/*#__PURE__*/_jsx(MaterialLibrary,{materials:selectedMaterials})})]});};export default GenerationImg;","map":{"version":3,"names":["React","useEffect","useState","StepBar","InputBox","MaterialLibrary","ShowImg","useIndexedDBStorage","LoadingAnimation","jsx","_jsx","jsxs","_jsxs","GenerationImg","_ref","currentStep","handleNextStep","handlePrevStep","selectedMaterials","onAddMaterial","inputValue","setInputValue","isUploading","setIsUploading","showImages","setShowImages","useSessionStorageState","generatedImages","setGeneratedImages","key","defaultValue","state","setState","storedValue","sessionStorage","getItem","JSON","parse","setItem","stringify","handleInputChange","e","target","value","handleUpload","console","log","response","fetch","method","headers","body","prompt","ok","imagesBase64","json","imagesUrls","map","imgBase64","concat","prevImages","error","handleKeyPress","className","children","onAddToLibrary","images","onChange","onUpload","onKeyPress","materials"],"sources":["F:/同济实习/cutting/src/containers/GenerationImg/GenerationImg.js"],"sourcesContent":["import React, {useEffect, useState} from 'react';\r\nimport StepBar from '../../components/StepBar/StepBar';\r\nimport InputBox from '../../components/InputBox/InputBox';\r\nimport MaterialLibrary from '../../components/MaterialLibrary/MaterialLibrary';\r\nimport ShowImg from '../../components/ShowImg/ShowImg';\r\nimport './GenerationImg.css';\r\nimport { useIndexedDBStorage } from './storage';\r\nimport LoadingAnimation from \"../../components/loadingicon/loadingicon\";  // ȷ������·����ȷ\r\n\r\nconst GenerationImg = ({ currentStep, handleNextStep, handlePrevStep, selectedMaterials, onAddMaterial }) => {\r\n    const [inputValue, setInputValue] = useState('');\r\n    const [isUploading, setIsUploading] = useState(false);\r\n    const [showImages, setShowImages] = useSessionStorageState('showImages', false);\r\n    const [generatedImages, setGeneratedImages] = useIndexedDBStorage('generatedImages', []);\r\n    function useSessionStorageState(key, defaultValue) {\r\n        const [state, setState] = useState(() => {\r\n            const storedValue = sessionStorage.getItem(key);\r\n            return storedValue !== null ? JSON.parse(storedValue) : defaultValue;\r\n        });\r\n\r\n        useEffect(() => {\r\n            sessionStorage.setItem(key, JSON.stringify(state));\r\n        }, [key, state]);\r\n\r\n        return [state, setState];\r\n    }\r\n    const handleInputChange = (e) => {\r\n        setInputValue(e.target.value);\r\n    };\r\n\r\n    const handleUpload = async () => {\r\n        setIsUploading(true);\r\n        console.log('Uploading:', inputValue);\r\n\r\n        try {\r\n            const response = await fetch('http://202.120.165.127:8023/generate-image', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({ prompt: inputValue })\r\n            });\r\n            if (response.ok) {\r\n                const imagesBase64 = await response.json();\r\n                const imagesUrls = imagesBase64.map(imgBase64 => `data:image/png;base64,${imgBase64}`);\r\n                setGeneratedImages(prevImages => [...prevImages, ...imagesUrls]);\r\n                setShowImages(true);\r\n            } else {\r\n                console.error('Failed to generate image');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error:', error);\r\n        }\r\n\r\n        setInputValue('');\r\n        setIsUploading(false);\r\n    };\r\n\r\n    const handleKeyPress = (e) => {\r\n        if (e.key === 'Enter') {\r\n            handleUpload();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"container\">\r\n            <div className=\"left-side\">\r\n                <StepBar currentStep={currentStep} handleNextStep={handleNextStep} handlePrevStep={handlePrevStep} />\r\n                <div className=\"middle\">\r\n                    {showImages && <ShowImg onAddToLibrary={onAddMaterial} images={generatedImages} />}\r\n                    {isUploading && <LoadingAnimation />}\r\n                </div>\r\n                <div className=\"bottom\">\r\n                    <InputBox value={inputValue} onChange={handleInputChange} onUpload={handleUpload} onKeyPress={handleKeyPress} isUploading={isUploading} />\r\n                </div>\r\n            </div>\r\n            <div className=\"right-side\">\r\n                <MaterialLibrary materials={selectedMaterials} />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GenerationImg;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}