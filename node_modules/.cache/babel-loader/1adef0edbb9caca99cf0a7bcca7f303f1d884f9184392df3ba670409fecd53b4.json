{"ast":null,"code":"var _jsxFileName = \"F:\\\\\\u540C\\u6D4E\\u5B9E\\u4E60\\\\cutting\\\\src\\\\components\\\\SketchBox\\\\remake.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect } from 'react';\nimport { fabric } from 'fabric';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Remake = ({\n  targets,\n  setTargets\n}) => {\n  _s();\n  const canvasRef = useRef(null);\n  const canvasSize = {\n    width: 512,\n    height: 512\n  };\n  useEffect(() => {\n    const canvas = new fabric.Canvas(canvasRef.current, {\n      width: canvasSize.width,\n      height: canvasSize.height,\n      backgroundColor: 'white'\n    });\n\n    // 设置画布的缩放和拖拽功能\n    canvas.setZoom(1);\n    canvas.setViewportTransform([1, 0, 0, 1, 0, 0]);\n    canvas.selection = true; // 允许选择对象\n\n    const handleDrop = event => {\n      event.preventDefault();\n      const files = event.dataTransfer.files;\n      for (let i = 0; i < files.length; i++) {\n        if (files[i].type.startsWith('image/')) {\n          const reader = new FileReader();\n          reader.onload = e => {\n            const img = new Image();\n            img.src = e.target.result;\n            img.onload = () => {\n              const fabricImage = new fabric.Image(img, {\n                left: 100,\n                // Set initial position\n                top: 100\n              });\n              fabricImage.scaleToWidth(canvasSize.width / 3); // Scale image\n              canvas.add(fabricImage); // Add image to canvas\n              setTargets(prevTargets => [...prevTargets, {\n                src: e.target.result,\n                x: 100,\n                // Initial position\n                y: 100,\n                width: fabricImage.width * fabricImage.scaleX,\n                // Adjust for scaling\n                height: fabricImage.height * fabricImage.scaleY,\n                rotate: 0 // Initial rotation\n              }]);\n            };\n          };\n          reader.readAsDataURL(files[i]);\n        }\n      }\n    };\n    const handleDragOver = event => {\n      event.preventDefault();\n    };\n\n    // 添加事件监听器\n    canvasRef.current.addEventListener('drop', handleDrop);\n    canvasRef.current.addEventListener('dragover', handleDragOver);\n\n    // 清理副作用\n    return () => {\n      canvasRef.current.removeEventListener('drop', handleDrop);\n      canvasRef.current.removeEventListener('dragover', handleDragOver);\n    };\n  }, [targets, setTargets]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"canvas-container\",\n    style: {\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      border: '1px solid black'\n    },\n    children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        width: '100%',\n        height: '100%'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 9\n  }, this);\n};\n_s(Remake, \"UJgi7ynoup7eqypjnwyX/s32POg=\");\n_c = Remake;\nexport default Remake;\nvar _c;\n$RefreshReg$(_c, \"Remake\");","map":{"version":3,"names":["React","useRef","useEffect","fabric","jsxDEV","_jsxDEV","Remake","targets","setTargets","_s","canvasRef","canvasSize","width","height","canvas","Canvas","current","backgroundColor","setZoom","setViewportTransform","selection","handleDrop","event","preventDefault","files","dataTransfer","i","length","type","startsWith","reader","FileReader","onload","e","img","Image","src","target","result","fabricImage","left","top","scaleToWidth","add","prevTargets","x","y","scaleX","scaleY","rotate","readAsDataURL","handleDragOver","addEventListener","removeEventListener","className","style","position","border","children","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["F:/同济实习/cutting/src/components/SketchBox/remake.js"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\r\nimport { fabric } from 'fabric';\r\n\r\nconst Remake = ({ targets, setTargets }) => {\r\n    const canvasRef = useRef(null);\r\n    const canvasSize = { width: 512, height: 512 };\r\n\r\n    useEffect(() => {\r\n        const canvas = new fabric.Canvas(canvasRef.current, {\r\n            width: canvasSize.width,\r\n            height: canvasSize.height,\r\n            backgroundColor: 'white',\r\n        });\r\n\r\n        // 设置画布的缩放和拖拽功能\r\n        canvas.setZoom(1);\r\n        canvas.setViewportTransform([1, 0, 0, 1, 0, 0]);\r\n        canvas.selection = true; // 允许选择对象\r\n\r\n        const handleDrop = (event) => {\r\n            event.preventDefault();\r\n            const files = event.dataTransfer.files;\r\n            for (let i = 0; i < files.length; i++) {\r\n                if (files[i].type.startsWith('image/')) {\r\n                    const reader = new FileReader();\r\n                    reader.onload = (e) => {\r\n                        const img = new Image();\r\n                        img.src = e.target.result;\r\n                        img.onload = () => {\r\n                            const fabricImage = new fabric.Image(img, {\r\n                                left: 100, // Set initial position\r\n                                top: 100,\r\n                            });\r\n                            fabricImage.scaleToWidth(canvasSize.width / 3); // Scale image\r\n                            canvas.add(fabricImage); // Add image to canvas\r\n                            setTargets(prevTargets => [...prevTargets, {\r\n                                src: e.target.result,\r\n                                x: 100, // Initial position\r\n                                y: 100,\r\n                                width: fabricImage.width * fabricImage.scaleX, // Adjust for scaling\r\n                                height: fabricImage.height * fabricImage.scaleY,\r\n                                rotate: 0, // Initial rotation\r\n                            }]);\r\n                        };\r\n                    };\r\n                    reader.readAsDataURL(files[i]);\r\n                }\r\n            }\r\n        };\r\n\r\n        const handleDragOver = (event) => {\r\n            event.preventDefault();\r\n        };\r\n\r\n        // 添加事件监听器\r\n        canvasRef.current.addEventListener('drop', handleDrop);\r\n        canvasRef.current.addEventListener('dragover', handleDragOver);\r\n\r\n        // 清理副作用\r\n        return () => {\r\n            canvasRef.current.removeEventListener('drop', handleDrop);\r\n            canvasRef.current.removeEventListener('dragover', handleDragOver);\r\n        };\r\n    }, [targets, setTargets]);\r\n\r\n    return (\r\n        <div\r\n            className=\"canvas-container\"\r\n            style={{\r\n                position: 'relative',\r\n                width: '100%',\r\n                height: '100%',\r\n                border: '1px solid black',\r\n            }}\r\n        >\r\n            <canvas\r\n                ref={canvasRef}\r\n                style={{\r\n                    width: '100%',\r\n                    height: '100%',\r\n                }}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Remake;\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,MAAM,EAAEC,SAAS,QAAQ,OAAO;AAChD,SAASC,MAAM,QAAQ,QAAQ;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEhC,MAAMC,MAAM,GAAGA,CAAC;EAAEC,OAAO;EAAEC;AAAW,CAAC,KAAK;EAAAC,EAAA;EACxC,MAAMC,SAAS,GAAGT,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMU,UAAU,GAAG;IAAEC,KAAK,EAAE,GAAG;IAAEC,MAAM,EAAE;EAAI,CAAC;EAE9CX,SAAS,CAAC,MAAM;IACZ,MAAMY,MAAM,GAAG,IAAIX,MAAM,CAACY,MAAM,CAACL,SAAS,CAACM,OAAO,EAAE;MAChDJ,KAAK,EAAED,UAAU,CAACC,KAAK;MACvBC,MAAM,EAAEF,UAAU,CAACE,MAAM;MACzBI,eAAe,EAAE;IACrB,CAAC,CAAC;;IAEF;IACAH,MAAM,CAACI,OAAO,CAAC,CAAC,CAAC;IACjBJ,MAAM,CAACK,oBAAoB,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IAC/CL,MAAM,CAACM,SAAS,GAAG,IAAI,CAAC,CAAC;;IAEzB,MAAMC,UAAU,GAAIC,KAAK,IAAK;MAC1BA,KAAK,CAACC,cAAc,CAAC,CAAC;MACtB,MAAMC,KAAK,GAAGF,KAAK,CAACG,YAAY,CAACD,KAAK;MACtC,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,KAAK,CAACG,MAAM,EAAED,CAAC,EAAE,EAAE;QACnC,IAAIF,KAAK,CAACE,CAAC,CAAC,CAACE,IAAI,CAACC,UAAU,CAAC,QAAQ,CAAC,EAAE;UACpC,MAAMC,MAAM,GAAG,IAAIC,UAAU,CAAC,CAAC;UAC/BD,MAAM,CAACE,MAAM,GAAIC,CAAC,IAAK;YACnB,MAAMC,GAAG,GAAG,IAAIC,KAAK,CAAC,CAAC;YACvBD,GAAG,CAACE,GAAG,GAAGH,CAAC,CAACI,MAAM,CAACC,MAAM;YACzBJ,GAAG,CAACF,MAAM,GAAG,MAAM;cACf,MAAMO,WAAW,GAAG,IAAIpC,MAAM,CAACgC,KAAK,CAACD,GAAG,EAAE;gBACtCM,IAAI,EAAE,GAAG;gBAAE;gBACXC,GAAG,EAAE;cACT,CAAC,CAAC;cACFF,WAAW,CAACG,YAAY,CAAC/B,UAAU,CAACC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;cAChDE,MAAM,CAAC6B,GAAG,CAACJ,WAAW,CAAC,CAAC,CAAC;cACzB/B,UAAU,CAACoC,WAAW,IAAI,CAAC,GAAGA,WAAW,EAAE;gBACvCR,GAAG,EAAEH,CAAC,CAACI,MAAM,CAACC,MAAM;gBACpBO,CAAC,EAAE,GAAG;gBAAE;gBACRC,CAAC,EAAE,GAAG;gBACNlC,KAAK,EAAE2B,WAAW,CAAC3B,KAAK,GAAG2B,WAAW,CAACQ,MAAM;gBAAE;gBAC/ClC,MAAM,EAAE0B,WAAW,CAAC1B,MAAM,GAAG0B,WAAW,CAACS,MAAM;gBAC/CC,MAAM,EAAE,CAAC,CAAE;cACf,CAAC,CAAC,CAAC;YACP,CAAC;UACL,CAAC;UACDnB,MAAM,CAACoB,aAAa,CAAC1B,KAAK,CAACE,CAAC,CAAC,CAAC;QAClC;MACJ;IACJ,CAAC;IAED,MAAMyB,cAAc,GAAI7B,KAAK,IAAK;MAC9BA,KAAK,CAACC,cAAc,CAAC,CAAC;IAC1B,CAAC;;IAED;IACAb,SAAS,CAACM,OAAO,CAACoC,gBAAgB,CAAC,MAAM,EAAE/B,UAAU,CAAC;IACtDX,SAAS,CAACM,OAAO,CAACoC,gBAAgB,CAAC,UAAU,EAAED,cAAc,CAAC;;IAE9D;IACA,OAAO,MAAM;MACTzC,SAAS,CAACM,OAAO,CAACqC,mBAAmB,CAAC,MAAM,EAAEhC,UAAU,CAAC;MACzDX,SAAS,CAACM,OAAO,CAACqC,mBAAmB,CAAC,UAAU,EAAEF,cAAc,CAAC;IACrE,CAAC;EACL,CAAC,EAAE,CAAC5C,OAAO,EAAEC,UAAU,CAAC,CAAC;EAEzB,oBACIH,OAAA;IACIiD,SAAS,EAAC,kBAAkB;IAC5BC,KAAK,EAAE;MACHC,QAAQ,EAAE,UAAU;MACpB5C,KAAK,EAAE,MAAM;MACbC,MAAM,EAAE,MAAM;MACd4C,MAAM,EAAE;IACZ,CAAE;IAAAC,QAAA,eAEFrD,OAAA;MACIsD,GAAG,EAAEjD,SAAU;MACf6C,KAAK,EAAE;QACH3C,KAAK,EAAE,MAAM;QACbC,MAAM,EAAE;MACZ;IAAE;MAAA+C,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACD,CAAC;AAEd,CAAC;AAACtD,EAAA,CAjFIH,MAAM;AAAA0D,EAAA,GAAN1D,MAAM;AAmFZ,eAAeA,MAAM;AAAC,IAAA0D,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}