{"ast":null,"code":"import{useState,useEffect}from'react';import localForage from'localforage';export function useIndexedDBStorage(key,initialValue){const[state,setState]=useState(initialValue);// �� IndexedDB ��ȡ����\nuseEffect(()=>{localForage.getItem(key).then(storedValue=>{if(storedValue!==null){setState(storedValue);}});},[key]);// ���� state �仯������ IndexedDB\nuseEffect(()=>{localForage.setItem(key,state);// ������������������������ر��¼�\nconst handleUnload=()=>{localForage.removeItem(key);};// �����¼�������\nwindow.addEventListener('unload',handleUnload);// ����һ���������������������ж��ʱ�Ƴ��¼�������\nreturn()=>{window.removeEventListener('unload',handleUnload);};},[key,state]);return[state,setState];}","map":{"version":3,"names":["useState","useEffect","localForage","useIndexedDBStorage","key","initialValue","state","setState","getItem","then","storedValue","setItem","handleUnload","removeItem","window","addEventListener","removeEventListener"],"sources":["F:/同济实习/cutting英文版/cutting/src/containers/GenerationImg/storage.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport localForage from 'localforage';\r\n\r\nexport function useIndexedDBStorage(key, initialValue) {\r\n    const [state, setState] = useState(initialValue);\r\n\r\n    // �� IndexedDB ��ȡ����\r\n    useEffect(() => {\r\n        localForage.getItem(key).then(storedValue => {\r\n            if (storedValue !== null) {\r\n                setState(storedValue);\r\n            }\r\n        });\r\n    }, [key]);\r\n\r\n    // ���� state �仯������ IndexedDB\r\n    useEffect(() => {\r\n        localForage.setItem(key, state);\r\n\r\n        // ������������������������ر��¼�\r\n        const handleUnload = () => {\r\n            localForage.removeItem(key);\r\n        };\r\n\r\n        // �����¼�������\r\n        window.addEventListener('unload', handleUnload);\r\n\r\n        // ����һ���������������������ж��ʱ�Ƴ��¼�������\r\n        return () => {\r\n            window.removeEventListener('unload', handleUnload);\r\n        };\r\n    }, [key, state]);\r\n\r\n    return [state, setState];\r\n}\r\n"],"mappings":"AAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,MAAO,CAAAC,WAAW,KAAM,aAAa,CAErC,MAAO,SAAS,CAAAC,mBAAmBA,CAACC,GAAG,CAAEC,YAAY,CAAE,CACnD,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAGP,QAAQ,CAACK,YAAY,CAAC,CAEhD;AACAJ,SAAS,CAAC,IAAM,CACZC,WAAW,CAACM,OAAO,CAACJ,GAAG,CAAC,CAACK,IAAI,CAACC,WAAW,EAAI,CACzC,GAAIA,WAAW,GAAK,IAAI,CAAE,CACtBH,QAAQ,CAACG,WAAW,CAAC,CACzB,CACJ,CAAC,CAAC,CACN,CAAC,CAAE,CAACN,GAAG,CAAC,CAAC,CAET;AACAH,SAAS,CAAC,IAAM,CACZC,WAAW,CAACS,OAAO,CAACP,GAAG,CAAEE,KAAK,CAAC,CAE/B;AACA,KAAM,CAAAM,YAAY,CAAGA,CAAA,GAAM,CACvBV,WAAW,CAACW,UAAU,CAACT,GAAG,CAAC,CAC/B,CAAC,CAED;AACAU,MAAM,CAACC,gBAAgB,CAAC,QAAQ,CAAEH,YAAY,CAAC,CAE/C;AACA,MAAO,IAAM,CACTE,MAAM,CAACE,mBAAmB,CAAC,QAAQ,CAAEJ,YAAY,CAAC,CACtD,CAAC,CACL,CAAC,CAAE,CAACR,GAAG,CAAEE,KAAK,CAAC,CAAC,CAEhB,MAAO,CAACA,KAAK,CAAEC,QAAQ,CAAC,CAC5B"},"metadata":{},"sourceType":"module","externalDependencies":[]}