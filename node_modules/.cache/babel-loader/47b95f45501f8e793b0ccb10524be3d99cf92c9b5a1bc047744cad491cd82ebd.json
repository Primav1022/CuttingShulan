{"ast":null,"code":"import React,{forwardRef,useCallback,useEffect,useImperativeHandle,useRef,useState}from'react';import'./ShowClothes.css';import clothImageSrc from'./dress.png';import{jsx as _jsx}from\"react/jsx-runtime\";const ClothBox=/*#__PURE__*/forwardRef((_ref,ref)=>{let{fileCounter,sketchDataURL,patternDataURL,selected,spacing,selectedColor,selectedName}=_ref;const canvasRef=useRef(null);const saveCanvasAsImage=useCallback(()=>{const canvas=canvasRef.current;if(canvas){const imageData=patternDataURL;const fileName=selectedName||\"衬衫\";// 如果选中了名字则用选中的名字，否则使用默认名字\"衬衫\"\nconst fileNumber=fileCounter;// 使用自增的编号\nconsole.log('fi'+fileCounter);const link=document.createElement('a');link.href=imageData;link.download=\"\".concat(fileName,\"_\").concat(fileNumber,\".png\");// 设置下载的文件名，带上自增编号\ndocument.body.appendChild(link);link.click();document.body.removeChild(link);}},[patternDataURL,selectedName,fileCounter]);// 添加了fileCounter到依赖数组中\nuseImperativeHandle(ref,()=>({saveCanvasAsImage}));useEffect(()=>{const clothCanvas=canvasRef.current;if(!clothCanvas)return;const clothCtx=clothCanvas.getContext('2d');const patternImage=new Image();const clothImage=new Image();const maskImage=new Image();const maskDataURL=\"/image/img.png\";clothImage.onload=()=>{clothCanvas.width=clothImage.width;clothCanvas.height=clothImage.height;clothCtx.clearRect(0,0,clothCanvas.width,clothCanvas.height);clothCtx.drawImage(clothImage,0,0);patternImage.onload=()=>{const tempCanvas=document.createElement('canvas');const tempCtx=tempCanvas.getContext('2d');tempCanvas.width=clothCanvas.width;tempCanvas.height=clothCanvas.height;const scaleX=tempCanvas.width/patternImage.width;const scaleY=tempCanvas.height/patternImage.height;const scale=Math.max(scaleX,scaleY);const patternWidth=patternImage.width*scale;const patternHeight=patternImage.height*scale;const offsetX=(tempCanvas.width-patternWidth)/2;const offsetY=(tempCanvas.height-patternHeight)/2;tempCtx.drawImage(patternImage,offsetX,offsetY,patternWidth,patternHeight);const patternMaskCanvas=document.createElement('canvas');const patternMaskCtx=patternMaskCanvas.getContext('2d');patternMaskCanvas.width=maskImage.width;patternMaskCanvas.height=maskImage.height;patternMaskCtx.drawImage(maskImage,0,0);const patternMaskImageData=patternMaskCtx.getImageData(0,0,maskImage.width,maskImage.height);const tempImageData=tempCtx.getImageData(0,0,tempCanvas.width,tempCanvas.height);for(let i=0;i<patternMaskImageData.data.length;i+=4){if(patternMaskImageData.data[i+3]===0){tempImageData.data[i+3]=0;}}tempCtx.putImageData(tempImageData,0,0);clothCtx.globalCompositeOperation='multiply';clothCtx.drawImage(tempCanvas,0,0);clothCtx.globalCompositeOperation='source-over';};patternImage.src=patternDataURL;};clothImage.src=clothImageSrc;maskImage.src=maskDataURL;},[patternDataURL,selectedName]);return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,className:\"cloth-canvas\"})});});export default ClothBox;","map":{"version":3,"names":["React","forwardRef","useCallback","useEffect","useImperativeHandle","useRef","useState","clothImageSrc","jsx","_jsx","ClothBox","_ref","ref","fileCounter","sketchDataURL","patternDataURL","selected","spacing","selectedColor","selectedName","canvasRef","saveCanvasAsImage","canvas","current","imageData","fileName","fileNumber","console","log","link","document","createElement","href","download","concat","body","appendChild","click","removeChild","clothCanvas","clothCtx","getContext","patternImage","Image","clothImage","maskImage","maskDataURL","onload","width","height","clearRect","drawImage","tempCanvas","tempCtx","scaleX","scaleY","scale","Math","max","patternWidth","patternHeight","offsetX","offsetY","patternMaskCanvas","patternMaskCtx","patternMaskImageData","getImageData","tempImageData","i","data","length","putImageData","globalCompositeOperation","src","children","className"],"sources":["F:/同济实习/cutting/src/containers/ShowClothes/ClothBox.js"],"sourcesContent":["import React, { forwardRef, useCallback, useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport './ShowClothes.css';\nimport clothImageSrc from './dress.png';\n\nconst ClothBox = forwardRef(({ fileCounter,sketchDataURL, patternDataURL, selected, spacing, selectedColor,selectedName}, ref) => {\n  const canvasRef = useRef(null);\n\n\n  const saveCanvasAsImage = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const imageData = patternDataURL;\n      const fileName = selectedName || \"衬衫\"; // 如果选中了名字则用选中的名字，否则使用默认名字\"衬衫\"\n      const fileNumber = fileCounter; // 使用自增的编号\n      console.log('fi'+fileCounter)\n      const link = document.createElement('a');\n      link.href = imageData;\n      link.download = `${fileName}_${fileNumber}.png`; // 设置下载的文件名，带上自增编号\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n  }, [patternDataURL, selectedName, fileCounter]); // 添加了fileCounter到依赖数组中\n\n\n  useImperativeHandle(ref, () => ({\n    saveCanvasAsImage,\n  }));\n\n  useEffect(() => {\n    const clothCanvas = canvasRef.current;\n    if (!clothCanvas) return;\n    const clothCtx = clothCanvas.getContext('2d');\n    const patternImage = new Image();\n    const clothImage = new Image();\n    const maskImage = new Image();\n    const maskDataURL = \"/image/img.png\";\n\n    clothImage.onload = () => {\n      clothCanvas.width = clothImage.width;\n      clothCanvas.height = clothImage.height;\n      clothCtx.clearRect(0, 0, clothCanvas.width, clothCanvas.height);\n      clothCtx.drawImage(clothImage, 0, 0);\n\n      patternImage.onload = () => {\n        const tempCanvas = document.createElement('canvas');\n        const tempCtx = tempCanvas.getContext('2d');\n        tempCanvas.width = clothCanvas.width;\n        tempCanvas.height = clothCanvas.height;\n\n        const scaleX = tempCanvas.width / patternImage.width;\n        const scaleY = tempCanvas.height / patternImage.height;\n        const scale = Math.max(scaleX, scaleY);\n\n        const patternWidth = patternImage.width * scale;\n        const patternHeight = patternImage.height * scale;\n        const offsetX = (tempCanvas.width - patternWidth) / 2;\n        const offsetY = (tempCanvas.height - patternHeight) / 2;\n\n        tempCtx.drawImage(patternImage, offsetX, offsetY, patternWidth, patternHeight);\n\n        const patternMaskCanvas = document.createElement('canvas');\n        const patternMaskCtx = patternMaskCanvas.getContext('2d');\n        patternMaskCanvas.width = maskImage.width;\n        patternMaskCanvas.height = maskImage.height;\n        patternMaskCtx.drawImage(maskImage, 0, 0);\n\n        const patternMaskImageData = patternMaskCtx.getImageData(0, 0, maskImage.width, maskImage.height);\n        const tempImageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);\n        for (let i = 0; i < patternMaskImageData.data.length; i += 4) {\n          if (patternMaskImageData.data[i + 3] === 0) {\n            tempImageData.data[i + 3] = 0;\n          }\n        }\n        tempCtx.putImageData(tempImageData, 0, 0);\n\n        clothCtx.globalCompositeOperation = 'multiply';\n        clothCtx.drawImage(tempCanvas, 0, 0);\n\n        clothCtx.globalCompositeOperation = 'source-over';\n      };\n      patternImage.src = patternDataURL;\n    };\n\n    clothImage.src = clothImageSrc;\n    maskImage.src = maskDataURL;\n  }, [patternDataURL, selectedName]);\n\n  return (\n      <div>\n        <canvas ref={canvasRef} className=\"cloth-canvas\"></canvas>\n      </div>\n  );\n});\n\nexport default ClothBox;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}