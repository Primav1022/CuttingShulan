{"ast":null,"code":"import React,{forwardRef,useCallback,useEffect,useImperativeHandle,useRef}from'react';import'./ShowClothes.css';import clothImageSrc from'./dress.png';import{jsx as _jsx}from\"react/jsx-runtime\";const ClothBox=/*#__PURE__*/forwardRef((_ref,ref)=>{let{sketchDataURL,patternDataURL,selected,spacing}=_ref;const canvasRef=useRef(null);const saveCanvasAsImage=useCallback(()=>{const canvas=canvasRef.current;if(canvas){const imageData=patternDataURL;const link=document.createElement('a');link.href=imageData;link.download='canvas-image.png';document.body.appendChild(link);link.click();document.body.removeChild(link);}},[patternDataURL]);// ????????\n// const debounce = useCallback((func, wait) => {\n//   let timeout;\n//   return (...args) => {\n//     clearTimeout(timeout);\n//     timeout = setTimeout(() => {\n//       func.apply(this, args);\n//     }, wait);\n//   };\n// }, []);\nuseImperativeHandle(ref,()=>({saveCanvasAsImage}));console.log(canvasRef.current);useEffect(()=>{const clothCanvas=canvasRef.current;const clothCtx=clothCanvas.getContext('2d');const patternImage=new Image();const clothImage=new Image();clothImage.onload=()=>{clothCanvas.width=clothImage.width;clothCanvas.height=clothImage.height;clothCtx.clearRect(0,0,clothCanvas.width,clothCanvas.height);clothCtx.drawImage(clothImage,0,0);patternImage.onload=()=>{const tempCanvas=document.createElement('canvas');const tempCtx=tempCanvas.getContext('2d');tempCanvas.width=clothCanvas.width;tempCanvas.height=clothCanvas.height;tempCtx.drawImage(patternImage,0,0,tempCanvas.width,tempCanvas.height);tempCtx.globalCompositeOperation='destination-in';tempCtx.drawImage(clothImage,0,0,tempCanvas.width,tempCanvas.height);clothCtx.globalCompositeOperation='multiply';clothCtx.drawImage(tempCanvas,0,0);// ???��????????\nclothCtx.globalCompositeOperation='source-over';};patternImage.src=patternDataURL;};clothImage.src=clothImageSrc;console.log(clothImage.src);},[patternDataURL]);return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,className:\"cloth-canvas\"})});});export default ClothBox;","map":{"version":3,"names":["React","forwardRef","useCallback","useEffect","useImperativeHandle","useRef","clothImageSrc","jsx","_jsx","ClothBox","_ref","ref","sketchDataURL","patternDataURL","selected","spacing","canvasRef","saveCanvasAsImage","canvas","current","imageData","link","document","createElement","href","download","body","appendChild","click","removeChild","console","log","clothCanvas","clothCtx","getContext","patternImage","Image","clothImage","onload","width","height","clearRect","drawImage","tempCanvas","tempCtx","globalCompositeOperation","src","children","className"],"sources":["F:/同济实习/cutting/src/containers/ShowClothes/ClothBox.js"],"sourcesContent":["import React, {forwardRef, useCallback, useEffect, useImperativeHandle, useRef} from 'react';\nimport './ShowClothes.css';\nimport clothImageSrc from './dress.png';\nconst ClothBox = forwardRef(({ sketchDataURL, patternDataURL,selected,spacing }, ref) => {\n  const canvasRef = useRef(null);\n\n\n  const saveCanvasAsImage = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const imageData = patternDataURL;\n      const link = document.createElement('a');\n      link.href = imageData;\n      link.download = 'canvas-image.png';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n  }, [patternDataURL]);\n\n  // ????????\n  // const debounce = useCallback((func, wait) => {\n  //   let timeout;\n  //   return (...args) => {\n  //     clearTimeout(timeout);\n  //     timeout = setTimeout(() => {\n  //       func.apply(this, args);\n  //     }, wait);\n  //   };\n  // }, []);\n\n  useImperativeHandle(ref, () => ({\n    saveCanvasAsImage,\n  }));\n  console.log(canvasRef.current);\n  useEffect(() => {\n    const clothCanvas = canvasRef.current;\n    const clothCtx = clothCanvas.getContext('2d');\n    const patternImage = new Image();\n    const clothImage = new Image();\n\n    clothImage.onload = () => {\n      clothCanvas.width = clothImage.width;\n      clothCanvas.height = clothImage.height;\n      clothCtx.clearRect(0, 0, clothCanvas.width, clothCanvas.height);\n      clothCtx.drawImage(clothImage, 0, 0);\n\n      patternImage.onload = () => {\n        const tempCanvas = document.createElement('canvas');\n        const tempCtx = tempCanvas.getContext('2d');\n        tempCanvas.width = clothCanvas.width;\n        tempCanvas.height = clothCanvas.height;\n\n        tempCtx.drawImage(patternImage, 0, 0, tempCanvas.width, tempCanvas.height);\n\n        tempCtx.globalCompositeOperation = 'destination-in';\n        tempCtx.drawImage(clothImage, 0, 0, tempCanvas.width, tempCanvas.height);\n\n        clothCtx.globalCompositeOperation = 'multiply';\n        clothCtx.drawImage(tempCanvas, 0, 0);\n\n        // ???��????????\n        clothCtx.globalCompositeOperation = 'source-over';\n      };\n      patternImage.src = patternDataURL;\n\n\n    };\n    clothImage.src = clothImageSrc;\n    console.log(clothImage.src)\n  }, [patternDataURL]);\n\n\n\n\n\n  return (\n\n      <div >\n        <canvas ref={canvasRef} className=\"cloth-canvas\" ></canvas>\n        {/* �����Ǳ�ע�͵��Ķ��� canvas�������Ҫͬ��Ӧ����ʽ��ȡ��ע�Ͳ�������ʽ */}\n        {/* ?��????? */}\n        {/*<canvas ref={patternCanvasRef} className=\"pattern-canvas\"></canvas> /!* ??????? *!/*/}\n      </div>\n  );\n\n});\n\nexport default ClothBox;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}