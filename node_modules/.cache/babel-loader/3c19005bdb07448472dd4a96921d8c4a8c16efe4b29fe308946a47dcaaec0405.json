{"ast":null,"code":"import React,{useEffect,useState}from'react';import StepBar from'../../components/StepBar/StepBar';import InputBox from'../../components/InputBox/InputBox';import MaterialLibrary from'../../components/MaterialLibrary/MaterialLibrary';import ShowImg from'../../components/ShowImg/ShowImg';import'./GenerationImg.css';import{useIndexedDBStorage}from'./storage';import LoadingAnimation from\"../../components/loadingicon/loadingicon\";// 确保导入路径正确\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const GenerationImg=_ref=>{let{currentStep,handleNextStep,handlePrevStep,selectedMaterials,onAddMaterial}=_ref;const[inputValue,setInputValue]=useState('');const[isUploading,setIsUploading]=useState(false);const[isClicked,setIsClicked]=useState(false);const[showImages,setShowImages]=useSessionStorageState('showImages',false);const[generatedImages,setGeneratedImages]=useIndexedDBStorage('generatedImages',[]);function useSessionStorageState(key,defaultValue){const[state,setState]=useState(()=>{const storedValue=sessionStorage.getItem(key);return storedValue!==null?JSON.parse(storedValue):defaultValue;});useEffect(()=>{sessionStorage.setItem(key,JSON.stringify(state));},[key,state]);return[state,setState];}const handleInputChange=e=>{setInputValue(e.target.value);};const handleUpload=async()=>{setIsUploading(true);console.log('Uploading:',inputValue);try{const response=await fetch('http://202.120.165.127:8004/generate-image',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:inputValue})});if(response.ok){const imagesBase64=await response.json();const imagesUrls=imagesBase64.map(imgBase64=>\"data:image/png;base64,\".concat(imgBase64));setGeneratedImages(prevImages=>[...prevImages,...imagesUrls]);setShowImages(true);}else{console.error('Failed to generate image');}}catch(error){console.error('Error:',error);}// setInputValue('');\nsetIsUploading(false);setIsClicked(false);// 当按钮被点击时，更新状态为true\n};const handleRegenerateImages=()=>{setIsClicked(true);// 当按钮被点击时，更新状态为true\nhandleUpload();// Reuse the handleUpload function to regenerate images\n};const handleKeyPress=e=>{if(e.key==='Enter'){handleUpload();}};return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"left-side\",children:[/*#__PURE__*/_jsx(StepBar,{currentStep:currentStep,handleNextStep:handleNextStep,handlePrevStep:handlePrevStep}),/*#__PURE__*/_jsx(\"div\",{className:\"middle\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bgcolor\",children:[showImages&&/*#__PURE__*/_jsx(ShowImg,{setGeneratedImages:setGeneratedImages,onAddToLibrary:onAddMaterial,images:generatedImages,onRefresh:handleRegenerateImages,showImages:showImages,isClicked:isClicked}),isUploading&&/*#__PURE__*/_jsx(LoadingAnimation,{})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bottom\",children:/*#__PURE__*/_jsx(InputBox,{value:inputValue,onChange:handleInputChange,onUpload:handleUpload,onKeyPress:handleKeyPress,isUploading:isUploading})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"right-side\",children:/*#__PURE__*/_jsx(MaterialLibrary,{materials:selectedMaterials})})]});};export default GenerationImg;","map":{"version":3,"names":["React","useEffect","useState","StepBar","InputBox","MaterialLibrary","ShowImg","useIndexedDBStorage","LoadingAnimation","jsx","_jsx","jsxs","_jsxs","GenerationImg","_ref","currentStep","handleNextStep","handlePrevStep","selectedMaterials","onAddMaterial","inputValue","setInputValue","isUploading","setIsUploading","isClicked","setIsClicked","showImages","setShowImages","useSessionStorageState","generatedImages","setGeneratedImages","key","defaultValue","state","setState","storedValue","sessionStorage","getItem","JSON","parse","setItem","stringify","handleInputChange","e","target","value","handleUpload","console","log","response","fetch","method","headers","body","prompt","ok","imagesBase64","json","imagesUrls","map","imgBase64","concat","prevImages","error","handleRegenerateImages","handleKeyPress","className","children","onAddToLibrary","images","onRefresh","onChange","onUpload","onKeyPress","materials"],"sources":["F:/同济实习/cutting/src/containers/GenerationImg/GenerationImg.js"],"sourcesContent":["import React, {useEffect, useState} from 'react';\r\nimport StepBar from '../../components/StepBar/StepBar';\r\nimport InputBox from '../../components/InputBox/InputBox';\r\nimport MaterialLibrary from '../../components/MaterialLibrary/MaterialLibrary';\r\nimport ShowImg from '../../components/ShowImg/ShowImg';\r\nimport './GenerationImg.css';\r\nimport { useIndexedDBStorage } from './storage';\r\nimport LoadingAnimation from \"../../components/loadingicon/loadingicon\";  // 确保导入路径正确\r\n\r\n\r\nconst GenerationImg = ({ currentStep, handleNextStep, handlePrevStep, selectedMaterials, onAddMaterial }) => {\r\n    const [inputValue, setInputValue] = useState('');\r\n    const [isUploading, setIsUploading] = useState(false);\r\n    const [isClicked, setIsClicked] = useState(false);\r\n    const [showImages, setShowImages] = useSessionStorageState('showImages', false);\r\n    const [generatedImages, setGeneratedImages] = useIndexedDBStorage('generatedImages', []);\r\n    function useSessionStorageState(key, defaultValue) {\r\n        const [state, setState] = useState(() => {\r\n            const storedValue = sessionStorage.getItem(key);\r\n            return storedValue !== null ? JSON.parse(storedValue) : defaultValue;\r\n        });\r\n\r\n        useEffect(() => {\r\n            sessionStorage.setItem(key, JSON.stringify(state));\r\n        }, [key, state]);\r\n\r\n        return [state, setState];\r\n    }\r\n    const handleInputChange = (e) => {\r\n        setInputValue(e.target.value);\r\n    };\r\n\r\n    const handleUpload = async () => {\r\n        setIsUploading(true);\r\n        console.log('Uploading:', inputValue);\r\n\r\n        try {\r\n            const response = await fetch('http://202.120.165.127:8004/generate-image', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({ prompt: inputValue })\r\n            });\r\n            if (response.ok) {\r\n                const imagesBase64 = await response.json();\r\n                const imagesUrls = imagesBase64.map(imgBase64 => `data:image/png;base64,${imgBase64}`);\r\n                setGeneratedImages(prevImages => [...prevImages, ...imagesUrls]);\r\n                setShowImages(true);\r\n            } else {\r\n                console.error('Failed to generate image');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error:', error);\r\n        }\r\n\r\n        // setInputValue('');\r\n        setIsUploading(false);\r\n        setIsClicked(false);  // 当按钮被点击时，更新状态为true\r\n    };\r\n    const handleRegenerateImages = () => {\r\n        setIsClicked(true);  // 当按钮被点击时，更新状态为true\r\n        handleUpload();  // Reuse the handleUpload function to regenerate images\r\n\r\n    };\r\n\r\n    const handleKeyPress = (e) => {\r\n        if (e.key === 'Enter') {\r\n            handleUpload();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"container\">\r\n            <div className=\"left-side\">\r\n                <StepBar currentStep={currentStep} handleNextStep={handleNextStep} handlePrevStep={handlePrevStep} />\r\n                <div className=\"middle\">\r\n                    <div className=\"bgcolor\">\r\n                        {showImages && <ShowImg setGeneratedImages={setGeneratedImages} onAddToLibrary={onAddMaterial} images={generatedImages} onRefresh={handleRegenerateImages} showImages={showImages} isClicked={isClicked}/>}\r\n                        {isUploading && <LoadingAnimation />}\r\n                    </div>\r\n\r\n                </div>\r\n                <div className=\"bottom\">\r\n                    <InputBox value={inputValue} onChange={handleInputChange} onUpload={handleUpload} onKeyPress={handleKeyPress} isUploading={isUploading} />\r\n                </div>\r\n            </div>\r\n            <div className=\"right-side\">\r\n                <MaterialLibrary materials={selectedMaterials} />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GenerationImg;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}