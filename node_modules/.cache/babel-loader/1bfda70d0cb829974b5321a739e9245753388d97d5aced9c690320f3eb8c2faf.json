{"ast":null,"code":"import React,{useState,useEffect}from'react';import StepBar from'../../components/StepBar/StepBar';import MaterialLibrary from'../../components/MaterialLibrary/MaterialLibrary';import SketchBox from'../../components/SketchBox/SketchBox';import'./Makeunit.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Makeunit=props=>{const{currentStep,handleNextStep,handlePrevStep,selectedMaterials,onAddMaterial,onSaveSketch}=props;const[targets,setTargets]=useState(()=>{const savedTargets=sessionStorage.getItem('sketchTargets');return savedTargets?JSON.parse(savedTargets):[];});useEffect(()=>{sessionStorage.setItem('sketchTargets',JSON.stringify(targets));},[targets]);useEffect(()=>{renderCanvas();},[targets]);// �������а���targets������ÿ��targets����ʱ�����ᴥ����useEffect\nfunction renderCanvas(){const sketchBox=document.querySelector('.sketch-box');if(!sketchBox)return;// ȷ��sketchBox�Ѿ�����Ⱦ\nconst canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');// canvas.width = sketchBox.offsetWidth;\n// canvas.height = sketchBox.offsetHeight;\ncanvas.width=512;canvas.height=512;const drawImageOnCanvas=target=>new Promise(resolve=>{const img=new Image();img.src=target.src;img.onload=()=>{ctx.save();ctx.translate(target.x+target.width/2,target.y+target.height/2);ctx.rotate(target.rotate*Math.PI/180);// ����ͼ���Ƿ���ȫ��������\nconst halfWidth=target.width/2;const halfHeight=target.height/2;ctx.drawImage(img,-halfWidth,-halfHeight,target.width,target.height);ctx.restore();resolve();};});Promise.all(targets.map(drawImageOnCanvas)).then(()=>{const dataURL=canvas.toDataURL('image/png',1);onSaveSketch(dataURL);// ��dataURL����������������������\n});}return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"left-side\",children:[/*#__PURE__*/_jsx(StepBar,{currentStep:currentStep,handleNextStep:handleNextStep,handlePrevStep:handlePrevStep,onSavePattern:renderCanvas}),/*#__PURE__*/_jsx(\"div\",{className:\"middle\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bgcolor\",children:/*#__PURE__*/_jsx(SketchBox,{targets:targets,setTargets:setTargets})})}),/*#__PURE__*/_jsx(\"div\",{className:\"unitbottom\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"right-side\",children:/*#__PURE__*/_jsx(MaterialLibrary,{materials:selectedMaterials,onAddMaterial:onAddMaterial})})]});};export default Makeunit;","map":{"version":3,"names":["React","useState","useEffect","StepBar","MaterialLibrary","SketchBox","jsx","_jsx","jsxs","_jsxs","Makeunit","props","currentStep","handleNextStep","handlePrevStep","selectedMaterials","onAddMaterial","onSaveSketch","targets","setTargets","savedTargets","sessionStorage","getItem","JSON","parse","setItem","stringify","renderCanvas","sketchBox","document","querySelector","canvas","createElement","ctx","getContext","width","height","drawImageOnCanvas","target","Promise","resolve","img","Image","src","onload","save","translate","x","y","rotate","Math","PI","halfWidth","halfHeight","drawImage","restore","all","map","then","dataURL","toDataURL","className","children","onSavePattern","materials"],"sources":["F:/同济实习/cutting/src/containers/Makeunit/Makeunit.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport StepBar from '../../components/StepBar/StepBar';\r\nimport MaterialLibrary from '../../components/MaterialLibrary/MaterialLibrary';\r\nimport SketchBox from '../../components/SketchBox/SketchBox';\r\nimport './Makeunit.css';\r\n\r\nconst Makeunit = (props) => {\r\n  const { currentStep, handleNextStep, handlePrevStep, selectedMaterials, onAddMaterial, onSaveSketch } = props;\r\n  const [targets, setTargets] = useState(() => {\r\n    const savedTargets = sessionStorage.getItem('sketchTargets');\r\n    return savedTargets ? JSON.parse(savedTargets) : [];\r\n  });\r\n\r\n  useEffect(() => {\r\n    sessionStorage.setItem('sketchTargets', JSON.stringify(targets));\r\n  }, [targets]);\r\n\r\n  useEffect(() => {\r\n    renderCanvas();\r\n  }, [targets]); // �������а���targets������ÿ��targets����ʱ�����ᴥ����useEffect\r\n\r\n  function renderCanvas() {\r\n    const sketchBox = document.querySelector('.sketch-box');\r\n    if (!sketchBox) return; // ȷ��sketchBox�Ѿ�����Ⱦ\r\n\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    // canvas.width = sketchBox.offsetWidth;\r\n    // canvas.height = sketchBox.offsetHeight;\r\n\r\n    canvas.width = 512;\r\n    canvas.height = 512;\r\n\r\n    const drawImageOnCanvas = (target) => new Promise((resolve) => {\r\n      const img = new Image();\r\n      img.src = target.src;\r\n      img.onload = () => {\r\n        ctx.save();\r\n        ctx.translate(target.x + target.width / 2, target.y + target.height / 2);\r\n        ctx.rotate(target.rotate * Math.PI / 180);\r\n        // ����ͼ���Ƿ���ȫ��������\r\n        const halfWidth = target.width / 2;\r\n        const halfHeight = target.height / 2;\r\n\r\n          ctx.drawImage(img, -halfWidth, -halfHeight, target.width, target.height);\r\n\r\n        ctx.restore();\r\n        resolve();\r\n      };\r\n    });\r\n\r\n    Promise.all(targets.map(drawImageOnCanvas)).then(() => {\r\n      const dataURL = canvas.toDataURL('image/png', 1);\r\n      onSaveSketch(dataURL); // ��dataURL����������������������\r\n    });\r\n  }\r\n\r\n  return (\r\n      <div className=\"container\">\r\n        <div className=\"left-side\">\r\n          <StepBar currentStep={currentStep} handleNextStep={handleNextStep} handlePrevStep={handlePrevStep} onSavePattern={renderCanvas} />\r\n          <div className=\"middle\">\r\n            <div className=\"bgcolor\">\r\n            <SketchBox targets={targets} setTargets={setTargets} />\r\n            </div>\r\n          </div>\r\n          <div className=\"unitbottom\"></div>\r\n        </div>\r\n        <div className=\"right-side\">\r\n          <MaterialLibrary materials={selectedMaterials} onAddMaterial={onAddMaterial} />\r\n        </div>\r\n      </div>\r\n  );\r\n};\r\n\r\nexport default Makeunit;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}