{"ast":null,"code":"import React,{forwardRef,useCallback,useEffect,useImperativeHandle,useRef}from'react';import'./ShowClothes.css';import clothImageSrc from'./dress.png';import{jsx as _jsx}from\"react/jsx-runtime\";const ClothBox=/*#__PURE__*/forwardRef((_ref,ref)=>{let{sketchDataURL,patternDataURL,selected,spacing}=_ref;const canvasRef=useRef(null);const saveCanvasAsImage=useCallback(()=>{const canvas=canvasRef.current;if(canvas){const imageData=patternDataURL;const link=document.createElement('a');link.href=imageData;link.download='canvas-image.png';document.body.appendChild(link);link.click();document.body.removeChild(link);}},[patternDataURL]);useImperativeHandle(ref,()=>({saveCanvasAsImage}));useEffect(()=>{const clothCanvas=canvasRef.current;const clothCtx=clothCanvas.getContext('2d');const patternImage=new Image();const clothImage=new Image();clothImage.onload=()=>{clothCanvas.width=clothImage.width;clothCanvas.height=clothImage.height;clothCtx.clearRect(0,0,clothCanvas.width,clothCanvas.height);clothCtx.drawImage(clothImage,0,0);patternImage.onload=()=>{const tempCanvas=document.createElement('canvas');const tempCtx=tempCanvas.getContext('2d');tempCanvas.width=clothCanvas.width;tempCanvas.height=clothCanvas.height;// �����������������������ű���\nconst scaleX=tempCanvas.width/patternImage.width;const scaleY=tempCanvas.height/patternImage.height;const scale=Math.max(scaleX,scaleY);// ѡ��ϴ�����ű����Ը�����������\nconst patternWidth=patternImage.width*scale;const patternHeight=patternImage.height*scale;const offsetX=(tempCanvas.width-patternWidth)/2;// ˮƽ����\nconst offsetY=(tempCanvas.height-patternHeight)/2;// ��ֱ����\n// ʹ�����ű�������ͼ����ȷ��ͼ���������\ntempCtx.drawImage(patternImage,offsetX,offsetY,patternWidth,patternHeight);tempCtx.globalCompositeOperation='destination-in';tempCtx.drawImage(clothImage,0,0,tempCanvas.width,tempCanvas.height);clothCtx.globalCompositeOperation='multiply';clothCtx.drawImage(tempCanvas,0,0);// Reset composition operation\nclothCtx.globalCompositeOperation='source-over';};patternImage.src=patternDataURL;};clothImage.src=clothImageSrc;console.log(clothImage.src);},[patternDataURL]);return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,className:\"cloth-canvas\"})});});export default ClothBox;","map":{"version":3,"names":["React","forwardRef","useCallback","useEffect","useImperativeHandle","useRef","clothImageSrc","jsx","_jsx","ClothBox","_ref","ref","sketchDataURL","patternDataURL","selected","spacing","canvasRef","saveCanvasAsImage","canvas","current","imageData","link","document","createElement","href","download","body","appendChild","click","removeChild","clothCanvas","clothCtx","getContext","patternImage","Image","clothImage","onload","width","height","clearRect","drawImage","tempCanvas","tempCtx","scaleX","scaleY","scale","Math","max","patternWidth","patternHeight","offsetX","offsetY","globalCompositeOperation","src","console","log","children","className"],"sources":["F:/同济实习/cutting/src/containers/ShowClothes/ClothBox.js"],"sourcesContent":["import React, {forwardRef, useCallback, useEffect, useImperativeHandle, useRef} from 'react';\nimport './ShowClothes.css';\nimport clothImageSrc from './dress.png';\nconst ClothBox = forwardRef(({ sketchDataURL, patternDataURL,selected,spacing }, ref) => {\n  const canvasRef = useRef(null);\n\n\n  const saveCanvasAsImage = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const imageData = patternDataURL;\n      const link = document.createElement('a');\n      link.href = imageData;\n      link.download = 'canvas-image.png';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n  }, [patternDataURL]);\n\n\n  useImperativeHandle(ref, () => ({\n    saveCanvasAsImage,\n  }));\n\n  useEffect(() => {\n    const clothCanvas = canvasRef.current;\n    const clothCtx = clothCanvas.getContext('2d');\n    const patternImage = new Image();\n    const clothImage = new Image();\n\n    clothImage.onload = () => {\n      clothCanvas.width = clothImage.width;\n      clothCanvas.height = clothImage.height;\n      clothCtx.clearRect(0, 0, clothCanvas.width, clothCanvas.height);\n      clothCtx.drawImage(clothImage, 0, 0);\n\n      patternImage.onload = () => {\n        const tempCanvas = document.createElement('canvas');\n        const tempCtx = tempCanvas.getContext('2d');\n        tempCanvas.width = clothCanvas.width;\n        tempCanvas.height = clothCanvas.height;\n\n        // �����������������������ű���\n        const scaleX = tempCanvas.width / patternImage.width;\n        const scaleY = tempCanvas.height / patternImage.height;\n        const scale = Math.max(scaleX, scaleY);  // ѡ��ϴ�����ű����Ը�����������\n\n        const patternWidth = patternImage.width * scale;\n        const patternHeight = patternImage.height * scale;\n        const offsetX = (tempCanvas.width - patternWidth) / 2;  // ˮƽ����\n        const offsetY = (tempCanvas.height - patternHeight) / 2;  // ��ֱ����\n\n        // ʹ�����ű�������ͼ����ȷ��ͼ���������\n        tempCtx.drawImage(patternImage, offsetX, offsetY, patternWidth, patternHeight);\n        tempCtx.globalCompositeOperation = 'destination-in';\n        tempCtx.drawImage(clothImage, 0, 0, tempCanvas.width, tempCanvas.height);\n\n        clothCtx.globalCompositeOperation = 'multiply';\n        clothCtx.drawImage(tempCanvas, 0, 0);\n\n        // Reset composition operation\n        clothCtx.globalCompositeOperation = 'source-over';\n      };\n      patternImage.src = patternDataURL;\n    };\n\n    clothImage.src = clothImageSrc;\n    console.log(clothImage.src)\n  }, [patternDataURL]);\n\n\n\n\n\n  return (\n\n      <div >\n        <canvas ref={canvasRef} className=\"cloth-canvas\" ></canvas>\n\n      </div>\n  );\n\n});\n\nexport default ClothBox;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}