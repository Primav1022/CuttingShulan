{"ast":null,"code":"import React,{forwardRef,useCallback,useEffect,useRef,useImperativeHandle}from'react';import'./ShowClothes.css';import clothImageSrc from'./Remove-bg.ai_1713274468747(1).png';import{jsx as _jsx}from\"react/jsx-runtime\";const ClothBox=/*#__PURE__*/forwardRef((_ref,ref)=>{let{imgscale,sketchDataURL,patternDataURL,selected,spacing}=_ref;const canvasRef=useRef(null);const saveCanvasAsImage=useCallback(()=>{const canvas=canvasRef.current;if(canvas){const imageData=canvas.toDataURL('image/png',1.0);// Ensure you use the canvas data.\nconst link=document.createElement('a');link.href=imageData;link.download='canvas-image.png';document.body.appendChild(link);link.click();document.body.removeChild(link);}},[]);useImperativeHandle(ref,()=>({saveCanvasAsImage}));useEffect(()=>{const clothCanvas=canvasRef.current;if(!clothCanvas)return;const clothCtx=clothCanvas.getContext('2d');const patternImage=new Image();const clothImage=new Image();clothImage.onload=()=>{clothCanvas.width=clothImage.width;clothCanvas.height=clothImage.height;clothCtx.clearRect(0,0,clothCanvas.width,clothCanvas.height);clothCtx.drawImage(clothImage,0,0);patternImage.onload=()=>{const tempCanvas=document.createElement('canvas');const tempCtx=tempCanvas.getContext('2d');tempCanvas.width=clothCanvas.width;tempCanvas.height=clothCanvas.height;// �����������������������ű���\nconst scaleX=tempCanvas.width/patternImage.width;const scaleY=tempCanvas.height/patternImage.height;const scale=Math.max(scaleX,scaleY);// ѡ��ϴ�����ű����Ը�����������\nconst patternWidth=patternImage.width*scale;const patternHeight=patternImage.height*scale;const offsetX=(tempCanvas.width-patternWidth)/2;// ˮƽ����\nconst offsetY=(tempCanvas.height-patternHeight)/2;// ��ֱ����\n// ʹ�����ű�������ͼ����ȷ��ͼ���������\ntempCtx.drawImage(patternImage,offsetX,offsetY,patternWidth,patternHeight);tempCtx.globalCompositeOperation='destination-in';tempCtx.drawImage(clothImage,0,0,tempCanvas.width,tempCanvas.height);clothCtx.globalCompositeOperation='multiply';clothCtx.drawImage(tempCanvas,0,0);// Reset composition operation\nclothCtx.globalCompositeOperation='source-over';};patternImage.src=patternDataURL;};clothImage.src=clothImageSrc;},[patternDataURL]);return/*#__PURE__*/_jsx(\"div\",{className:\"canvas-container\",style:{marginTop:'50px'},children:/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,className:\"cloth-canvas\"})});});export default ClothBox;","map":{"version":3,"names":["React","forwardRef","useCallback","useEffect","useRef","useImperativeHandle","clothImageSrc","jsx","_jsx","ClothBox","_ref","ref","imgscale","sketchDataURL","patternDataURL","selected","spacing","canvasRef","saveCanvasAsImage","canvas","current","imageData","toDataURL","link","document","createElement","href","download","body","appendChild","click","removeChild","clothCanvas","clothCtx","getContext","patternImage","Image","clothImage","onload","width","height","clearRect","drawImage","tempCanvas","tempCtx","scaleX","scaleY","scale","Math","max","patternWidth","patternHeight","offsetX","offsetY","globalCompositeOperation","src","className","style","marginTop","children"],"sources":["F:/同济实习/cutting/src/containers/ShowClothes/ClothBox2.js"],"sourcesContent":["import React, { forwardRef, useCallback, useEffect, useRef, useImperativeHandle } from 'react';\r\nimport './ShowClothes.css';\r\nimport clothImageSrc from './Remove-bg.ai_1713274468747(1).png';\r\n\r\nconst ClothBox = forwardRef(({ imgscale, sketchDataURL, patternDataURL, selected, spacing }, ref) => {\r\n    const canvasRef = useRef(null);\r\n\r\n    const saveCanvasAsImage = useCallback(() => {\r\n        const canvas = canvasRef.current;\r\n        if (canvas) {\r\n            const imageData = canvas.toDataURL('image/png', 1.0); // Ensure you use the canvas data.\r\n            const link = document.createElement('a');\r\n            link.href = imageData;\r\n            link.download = 'canvas-image.png';\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            document.body.removeChild(link);\r\n        }\r\n    }, []);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        saveCanvasAsImage,\r\n    }));\r\n\r\n    useEffect(() => {\r\n        const clothCanvas = canvasRef.current;\r\n        if (!clothCanvas) return;\r\n        const clothCtx = clothCanvas.getContext('2d');\r\n        const patternImage = new Image();\r\n        const clothImage = new Image();\r\n\r\n        clothImage.onload = () => {\r\n            clothCanvas.width = clothImage.width;\r\n            clothCanvas.height = clothImage.height;\r\n            clothCtx.clearRect(0, 0, clothCanvas.width, clothCanvas.height);\r\n            clothCtx.drawImage(clothImage, 0, 0);\r\n\r\n            patternImage.onload = () => {\r\n                const tempCanvas = document.createElement('canvas');\r\n                const tempCtx = tempCanvas.getContext('2d');\r\n                tempCanvas.width = clothCanvas.width;\r\n                tempCanvas.height = clothCanvas.height;\r\n\r\n                // �����������������������ű���\r\n                const scaleX = tempCanvas.width / patternImage.width;\r\n                const scaleY = tempCanvas.height / patternImage.height;\r\n                const scale = Math.max(scaleX, scaleY);  // ѡ��ϴ�����ű����Ը�����������\r\n\r\n                const patternWidth = patternImage.width * scale;\r\n                const patternHeight = patternImage.height * scale;\r\n                const offsetX = (tempCanvas.width - patternWidth) / 2;  // ˮƽ����\r\n                const offsetY = (tempCanvas.height - patternHeight) / 2;  // ��ֱ����\r\n\r\n                // ʹ�����ű�������ͼ����ȷ��ͼ���������\r\n                tempCtx.drawImage(patternImage, offsetX, offsetY, patternWidth, patternHeight);\r\n                tempCtx.globalCompositeOperation = 'destination-in';\r\n                tempCtx.drawImage(clothImage, 0, 0, tempCanvas.width, tempCanvas.height);\r\n\r\n                clothCtx.globalCompositeOperation = 'multiply';\r\n                clothCtx.drawImage(tempCanvas, 0, 0);\r\n\r\n                // Reset composition operation\r\n                clothCtx.globalCompositeOperation = 'source-over';\r\n            };\r\n            patternImage.src = patternDataURL;\r\n        };\r\n\r\n        clothImage.src = clothImageSrc;\r\n    }, [patternDataURL]);\r\n\r\n    return (\r\n        <div className=\"canvas-container\" style={{ marginTop: '50px' }}>\r\n            <canvas ref={canvasRef} className=\"cloth-canvas\"></canvas>\r\n        </div>\r\n    );\r\n});\r\n\r\nexport default ClothBox;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}