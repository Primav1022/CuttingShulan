{"ast":null,"code":"var _jsxFileName = \"F:\\\\\\u540C\\u6D4E\\u5B9E\\u4E60\\\\cutting\\\\src\\\\components\\\\ContinuousPatterns\\\\ContinuousPatterns.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useCallback, forwardRef, useState } from 'react';\nimport './ContinuousPatterns.css'; // 引入样式文件\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ContinuousPatterns = /*#__PURE__*/_s( /*#__PURE__*/forwardRef(_c = _s(({\n  sketchDataURL,\n  selectedColor,\n  connectionType,\n  currentStep,\n  onSave,\n  spacing,\n  setSpacing,\n  imgscale,\n  setImgscale\n}, ref) => {\n  _s();\n  const canvasRef = useRef(null);\n  const [offsetX, setOffsetX] = useState(0); // 用于存储X轴偏移量的状态\n\n  // 用于设置 canvas 尺寸的函数\n  const setCanvasSize = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (canvas && canvas.parentElement) {\n      canvas.width = 4096;\n      canvas.height = 2048;\n    }\n  }, []);\n\n  // 绘制图案到 canvas\n  const drawPattern = useCallback(() => {\n    const canvas = canvasRef.current;\n    const context = canvas.getContext('2d');\n\n    // 清除 canvas\n    clearCanvas();\n    // 设置 canvas 背景颜色\n\n    context.fillStyle = selectedColor; // 使用 selectedColor 作为背景颜色\n    context.fillRect(0, 0, canvas.width, canvas.height); // 填充整个 canvas\n\n    const img = new Image();\n    img.onload = () => {\n      // const scaledWidth = img.width * 0.25+spacing; 'Butting',\n      //     'Lapping 1/4 on a row',\n      //     'Lapping 1/3 on a row',\n      //     'Lapping 1/2 on a row',\n      //     'Lapping 2/3 on a row',\n      //     'Lapping 3/4 on a row'\n      // const scaledHeight = img.height * 0.25+spacing;\n      const scaledWidth = img.width * imgscale;\n      const scaledHeight = img.height * imgscale;\n      const numTilesY = Math.ceil(canvas.height / scaledHeight);\n      const offsetMap = {\n        'Butting': 0,\n        'Lapping 1/4 on a row': 0.25,\n        'Lapping 1/3 on a row': 1 / 3,\n        'Lapping 1/2 on a row': 0.5,\n        'Lapping 2/3 on a row': 2 / 3,\n        'Lapping 3/4 on a row': 0.75\n      };\n      const jumpOffset = offsetMap[connectionType] || 0;\n      let currentOffsetX = 0;\n      for (let y = 0; y < numTilesY; y++) {\n        currentOffsetX = y * (scaledWidth + spacing) * jumpOffset % (scaledWidth + spacing);\n        for (let x = currentOffsetX - scaledWidth - spacing; x < canvas.width; x += scaledWidth + spacing) {\n          context.drawImage(img, x, y * (scaledHeight + spacing), scaledWidth, scaledHeight);\n        }\n      }\n\n      // 更新 offsetX 状态以存储当前的 X 轴偏移量\n      setOffsetX(currentOffsetX);\n      handleSave();\n    };\n    img.src = sketchDataURL;\n  }, [sketchDataURL, connectionType, currentStep, selectedColor, setOffsetX, spacing, imgscale]); // 添加 setOffsetX 作为依赖项\n  const handleSave = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const imageData = canvas.toDataURL(\"image/png\", 1, 300);\n      onSave(imageData); // 将图像数据传递给父组件\n    }\n  }, [onSave]);\n\n  // 防抖函数\n  const debounce = useCallback((func, wait) => {\n    let timeout;\n    return (...args) => {\n      clearTimeout(timeout);\n      timeout = setTimeout(() => {\n        func.apply(this, args);\n      }, wait);\n    };\n  }, []);\n  const clearCanvas = () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const context = canvas.getContext('2d');\n    // 清除画布\n    context.clearRect(0, 0, canvas.width, canvas.height);\n  };\n  useEffect(() => {\n    clearCanvas(); // 清除画布\n\n    // 设置 canvas 尺寸\n    setCanvasSize();\n\n    // 绘制新的图案\n    drawPattern();\n\n    // 定义窗口大小调整时的处理函数，该函数使用防抖以减少执行次数\n    const handleResize = debounce(() => {\n      clearCanvas(); // 在设置新尺寸之前先清除画布\n      setCanvasSize();\n      drawPattern(); // 重新绘制图案\n    }, 250);\n\n    // 监听窗口大小调整事件\n    window.addEventListener('resize', handleResize);\n\n    // 清理函数\n    return () => {\n      window.removeEventListener('resize', handleResize);\n    };\n  }, [debounce, setCanvasSize, drawPattern, sketchDataURL, selectedColor, connectionType, currentStep, spacing, imgscale]); // 将spacing添加到依赖项数组中\n\n  return (\n    /*#__PURE__*/\n    // <div className=\"continuous-patterns\" style={{ backgroundColor: selectedColor }}>\n    _jsxDEV(\"div\", {\n      className: \"continuous-patterns\",\n      children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        id: \"myCanvas\",\n        style: {\n          width: '60vw',\n          height: '60vh'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 14\n    }, this)\n  );\n}, \"YvR96dPFYO2HRx0W4aUMhABTm2M=\")), \"YvR96dPFYO2HRx0W4aUMhABTm2M=\");\n_c2 = ContinuousPatterns;\nexport default ContinuousPatterns;\nvar _c, _c2;\n$RefreshReg$(_c, \"ContinuousPatterns$forwardRef\");\n$RefreshReg$(_c2, \"ContinuousPatterns\");","map":{"version":3,"names":["React","useRef","useEffect","useCallback","forwardRef","useState","jsxDEV","_jsxDEV","ContinuousPatterns","_s","_c","sketchDataURL","selectedColor","connectionType","currentStep","onSave","spacing","setSpacing","imgscale","setImgscale","ref","canvasRef","offsetX","setOffsetX","setCanvasSize","canvas","current","parentElement","width","height","drawPattern","context","getContext","clearCanvas","fillStyle","fillRect","img","Image","onload","scaledWidth","scaledHeight","numTilesY","Math","ceil","offsetMap","jumpOffset","currentOffsetX","y","x","drawImage","handleSave","src","imageData","toDataURL","debounce","func","wait","timeout","args","clearTimeout","setTimeout","apply","clearRect","handleResize","window","addEventListener","removeEventListener","className","children","id","style","fileName","_jsxFileName","lineNumber","columnNumber","_c2","$RefreshReg$"],"sources":["F:/同济实习/cutting/src/components/ContinuousPatterns/ContinuousPatterns.js"],"sourcesContent":["import React, {useRef, useEffect, useCallback, forwardRef, useState} from 'react';\r\nimport './ContinuousPatterns.css'; // 引入样式文件\r\n\r\n\r\n\r\n\r\nconst ContinuousPatterns = forwardRef(({ sketchDataURL, selectedColor, connectionType, currentStep, onSave,spacing,setSpacing,imgscale,setImgscale }, ref) => {\r\n    const canvasRef = useRef(null);\r\n    const [offsetX, setOffsetX] = useState(0); // 用于存储X轴偏移量的状态\r\n\r\n    // 用于设置 canvas 尺寸的函数\r\n    const setCanvasSize = useCallback(() => {\r\n        const canvas = canvasRef.current;\r\n        if (canvas && canvas.parentElement) {\r\n            canvas.width = 4096;\r\n            canvas.height = 2048;\r\n\r\n        }\r\n    }, []);\r\n\r\n    // 绘制图案到 canvas\r\n    const drawPattern = useCallback(() => {\r\n        const canvas = canvasRef.current;\r\n        const context = canvas.getContext('2d');\r\n\r\n        // 清除 canvas\r\n        clearCanvas();\r\n        // 设置 canvas 背景颜色\r\n\r\n\r\n        context.fillStyle = selectedColor; // 使用 selectedColor 作为背景颜色\r\n        context.fillRect(0, 0, canvas.width, canvas.height); // 填充整个 canvas\r\n\r\n        const img = new Image();\r\n\r\n        img.onload = () => {\r\n            // const scaledWidth = img.width * 0.25+spacing; 'Butting',\r\n            //     'Lapping 1/4 on a row',\r\n            //     'Lapping 1/3 on a row',\r\n            //     'Lapping 1/2 on a row',\r\n            //     'Lapping 2/3 on a row',\r\n            //     'Lapping 3/4 on a row'\r\n            // const scaledHeight = img.height * 0.25+spacing;\r\n            const scaledWidth = img.width*imgscale ;\r\n            const scaledHeight = img.height*imgscale ;\r\n            const numTilesY = Math.ceil(canvas.height / scaledHeight);\r\n            const offsetMap = {\r\n                'Butting': 0,\r\n                'Lapping 1/4 on a row': 0.25,\r\n                'Lapping 1/3 on a row': 1 / 3,\r\n                'Lapping 1/2 on a row': 0.5,\r\n                'Lapping 2/3 on a row': 2 / 3,\r\n                'Lapping 3/4 on a row': 0.75,\r\n            };\r\n            const jumpOffset = offsetMap[connectionType] || 0;\r\n\r\n            let currentOffsetX = 0;\r\n\r\n            for (let y = 0; y < numTilesY; y++) {\r\n                currentOffsetX = y * (scaledWidth + spacing) * jumpOffset % (scaledWidth + spacing);\r\n\r\n                for (let x = currentOffsetX - scaledWidth - spacing; x < canvas.width; x += scaledWidth + spacing) {\r\n                    context.drawImage(img, x, y * (scaledHeight + spacing), scaledWidth, scaledHeight);\r\n                }\r\n            }\r\n\r\n            // 更新 offsetX 状态以存储当前的 X 轴偏移量\r\n            setOffsetX(currentOffsetX);\r\n            handleSave();\r\n        };\r\n\r\n        img.src = sketchDataURL;\r\n\r\n\r\n    }, [sketchDataURL, connectionType, currentStep, selectedColor, setOffsetX,spacing,imgscale]); // 添加 setOffsetX 作为依赖项\r\n    const handleSave = useCallback(() => {\r\n        const canvas = canvasRef.current;\r\n        if (canvas) {\r\n            const imageData = canvas.toDataURL(\"image/png\", 1, 300);\r\n            onSave(imageData); // 将图像数据传递给父组件\r\n        }\r\n    }, [onSave]);\r\n    \r\n    // 防抖函数\r\n    const debounce = useCallback((func, wait) => {\r\n        let timeout;\r\n        return (...args) => {\r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(() => {\r\n                func.apply(this, args);\r\n            }, wait);\r\n        };\r\n    }, []);\r\n    const clearCanvas = () => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas) return;\r\n        const context = canvas.getContext('2d');\r\n        // 清除画布\r\n        context.clearRect(0, 0, canvas.width, canvas.height);\r\n    };\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        clearCanvas(); // 清除画布\r\n\r\n        // 设置 canvas 尺寸\r\n        setCanvasSize();\r\n\r\n        // 绘制新的图案\r\n        drawPattern();\r\n\r\n        // 定义窗口大小调整时的处理函数，该函数使用防抖以减少执行次数\r\n        const handleResize = debounce(() => {\r\n            clearCanvas(); // 在设置新尺寸之前先清除画布\r\n            setCanvasSize();\r\n            drawPattern(); // 重新绘制图案\r\n        }, 250);\r\n\r\n        // 监听窗口大小调整事件\r\n        window.addEventListener('resize', handleResize);\r\n\r\n        // 清理函数\r\n        return () => {\r\n            window.removeEventListener('resize', handleResize);\r\n        };\r\n    }, [debounce, setCanvasSize, drawPattern, sketchDataURL, selectedColor, connectionType, currentStep, spacing,imgscale]); // 将spacing添加到依赖项数组中\r\n\r\n\r\n\r\n\r\n\r\n    return (\r\n         // <div className=\"continuous-patterns\" style={{ backgroundColor: selectedColor }}>\r\n             <div className=\"continuous-patterns\" >\r\n        <canvas ref={canvasRef} id=\"myCanvas\" style={{ width: '60vw', height: '60vh' }}/>\r\n        {/*<button onClick={handleSave}>Save next</button>*/}\r\n        {/*<button onClick={saveCanvasAsImage}>Save as Image</button>*/}\r\n    </div>\r\n    );\r\n});\r\n\r\nexport default ContinuousPatterns;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}